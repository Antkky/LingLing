<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <style type="text/css">
            html,
            body {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
                overflow: hidden;
                background-color: rgb(15, 15, 20);
            }
        </style>
        <meta charset="utf-8" />
        <title></title>
    </head>
    <body>
        <div id="container" style="width: 100%; height: 100%"></div>
        <script src="vs/loader.js"></script>
        <script type="text/javascript">
            require.config({ paths: { vs: "vs" } });
            // API
            var GetText;
            var SetText;
            var SetTheme;
            var SetScroll;
            var ShowErr;
            var Refresh;

            // Enablers
            var SwitchMinimap;
            var SwitchReadonly;
            var SwitchRenderWhitespace;
            var SwitchLinks;
            var SwitchLineHeight;
            var SwitchFontSize;
            var SwitchFolding;
            var SwitchAutoIndent;
            var SwitchFontFamily;
            var SwitchFontLigatures;
            var AddIntellisense;

            // Variables
            var editor;
            var Proposals = [];

            require(["vs/editor/editor.main"], function () {
                function getDependencyProposals() {
                    return Proposals;
                }

                monaco.languages.registerCompletionItemProvider("lua", {
                    provideCompletionItems: function (model, position) {
                        return getDependencyProposals();
                    },
                });

                monaco.editor.defineTheme("ling-theme-dark", {
                    base: "vs-dark",
                    inherit: true,
                    rules: [
                        // Keywords in purple
                        {
                            token: "keyword",
                            foreground: "C678DD",
                            fontStyle: "bold",
                        },
                        // Variables in light blue
                        { token: "variable", foreground: "80AAFF" },
                        { token: "variable.other", foreground: "80AAFF" },
                        { token: "variable.language", foreground: "80AAFF" },
                        // Constants in bright purple
                        { token: "constant", foreground: "FF80FF" },
                        { token: "constant.numeric", foreground: "FF80FF" },
                        { token: "constant.language", foreground: "FF80FF" },
                        // Strings in greenish-blue
                        { token: "string", foreground: "98C379" },
                        { token: "string.quoted", foreground: "98C379" },
                        { token: "string.template", foreground: "98C379" },
                        // Comments in light blue (italicized)
                        {
                            token: "comment",
                            foreground: "6272A4",
                            fontStyle: "italic",
                        },
                        {
                            token: "comment.block.documentation",
                            foreground: "6272A4",
                            fontStyle: "italic",
                        },
                        { token: "support.function", foreground: "FFCC66" },
                        { token: "support.class", foreground: "FFCC66" },
                        { token: "support.type", foreground: "FFCC66" },
                        // Punctuation in light grey
                        { token: "punctuation", foreground: "F8F8F2" },
                        // Meta in light grey
                        { token: "meta", foreground: "D0D0D0" },
                    ],
                    colors: {
                        // Background color
                        "editor.background": "#0F0F14", // Dark blue with purple undertones
                        // Text color
                        "editor.foreground": "#D1D1D1", // Light gray for general text
                        // Cursor color
                        "editorCursor.foreground": "#0e81a3", // cursor
                        // Line number color
                        "editorLineNumber.foreground": "#5A5A5A", // Light grey line numbers
                        // Selection background color
                        "editor.selectionBackground": "#3A3A63", // Blueish-purple selection background
                        // Selection highlight background
                        "editor.selectionHighlightBackground": "#404060", // Slightly darker selection highlight
                        // Inactive selection background
                        "editor.inactiveSelectionBackground": "#3A3A63", // Same as active selection for consistency
                    },
                });

                editor = monaco.editor.create(
                    document.getElementById("container"),
                    {
                        value: ["--[[", "	Script Here", "--]]"].join("\n"),
                        language: "lua",
                        theme: "ling-theme-dark",
                        folding: true,
                        scrollbar: {
                            vertical: "hidden",
                        },
                        dragAndDrop: true,
                        links: true,
                        minimap: {
                            enabled: false,
                        },
                        showFoldingControls: "always",
                        smoothScrolling: true,
                    }
                );

                window.onresize = function () {
                    editor.layout();
                };

                GetText = function () {
                    return editor.getValue();
                };

                SetText = function (x) {
                    editor.setValue(x);
                };

                SetTheme = function (themeName) {
                    if (themeName == "Dark") {
                        monaco.editor.setTheme("net-theme-dark");
                    }
                    if (themeName == "Light") {
                        monaco.editor.setTheme("net-theme-light");
                    }
                };

                SwitchMinimap = function (flag) {
                    editor.updateOptions({
                        minimap: {
                            enabled: flag,
                        },
                    });
                };

                SwitchReadonly = function (flag) {
                    editor.updateOptions({
                        readOnly: flag,
                    });
                };

                SwitchRenderWhitespace = function (op) {
                    editor.updateOptions({
                        renderWhitespace: op,
                    });
                };

                SwitchLinks = function (flag) {
                    editor.updateOptions({
                        links: flag,
                    });
                };

                SwitchLineHeight = function (num) {
                    editor.updateOptions({
                        lineHeight: num,
                    });
                };

                SwitchFontSize = function (num) {
                    editor.updateOptions({
                        fontSize: num,
                    });
                };

                SwitchFolding = function (flag) {
                    editor.updateOptions({
                        folding: flag,
                    });
                };

                SwitchAutoIndent = function (flag) {
                    editor.updateOptions({
                        autoIndent: flag,
                    });
                };

                SwitchFontFamily = function (name) {
                    editor.updateOptions({
                        fontFamily: name,
                    });
                };

                SwitchFontLigatures = function (flag) {
                    editor.updateOptions({
                        fontLigatures: flag,
                    });
                };

                ShowErr = function (
                    line,
                    column,
                    endline,
                    endcolumn,
                    errMessage
                ) {
                    editor.revealPositionInCenter({
                        lineNumber: line,
                        column: column,
                    });
                    editor.deltaDecorations(
                        [],
                        [
                            {
                                range: new monaco.Range(
                                    line,
                                    column,
                                    endline,
                                    endcolumn
                                ),
                                options: {
                                    inlineClassName: "squiggly-error",
                                    hoverMessage: {
                                        value: errMessage,
                                    },
                                },
                            },
                        ]
                    );
                };

                AddIntellisense = function (l, k, d, i) {
                    var t;
                    switch (k) {
                        case "Class":
                            t = monaco.languages.CompletionItemKind.Class;
                            break;
                        case "Color":
                            t = monaco.languages.CompletionItemKind.Color;
                            break;
                        case "Constructor":
                            t = monaco.languages.CompletionItemKind.Constructor;
                            break;
                        case "Enum":
                            t = monaco.languages.CompletionItemKind.Enum;
                            break;
                        case "Field":
                            t = monaco.languages.CompletionItemKind.Field;
                            break;
                        case "File":
                            t = monaco.languages.CompletionItemKind.File;
                            break;
                        case "Folder":
                            t = monaco.languages.CompletionItemKind.Folder;
                            break;
                        case "Function":
                            t = monaco.languages.CompletionItemKind.Function;
                            break;
                        case "Interface":
                            t = monaco.languages.CompletionItemKind.Interface;
                            break;
                        case "Keyword":
                            t = monaco.languages.CompletionItemKind.Keyword;
                            break;
                        case "Method":
                            t = monaco.languages.CompletionItemKind.Method;
                            break;
                        case "Module":
                            t = monaco.languages.CompletionItemKind.Module;
                            break;
                        case "Property":
                            t = monaco.languages.CompletionItemKind.Property;
                            break;
                        case "Reference":
                            t = monaco.languages.CompletionItemKind.Reference;
                            break;
                        case "Snippet":
                            t = monaco.languages.CompletionItemKind.Snippet;
                            break;
                        case "Text":
                            t = monaco.languages.CompletionItemKind.Text;
                            break;
                        case "Unit":
                            t = monaco.languages.CompletionItemKind.Unit;
                            break;
                        case "Value":
                            t = monaco.languages.CompletionItemKind.Value;
                            break;
                        case "Variable":
                            t = monaco.languages.CompletionItemKind.Variable;
                            break;
                    }

                    Proposals.push({
                        label: l,
                        kind: t,
                        detail: d,
                        insertText: i,
                    });
                };

                SetScroll = function (line) {
                    editor.revealLineInCenter({ lineNumber: line });
                };

                Refresh = function () {
                    var text = getText();
                    setText("");
                    editor.trigger("keyboard", "type", { text: text });
                };
            });
        </script>
    </body>
</html>
